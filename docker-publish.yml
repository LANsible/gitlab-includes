---
include:
  - remote: https://raw.githubusercontent.com/LANsible/gitlab-includes/master/docker-login.yml
  - remote: https://raw.githubusercontent.com/LANsible/gitlab-includes/master/_docker-extend.yml

# Publish branch image
publish_branch:
  extends: .build
  stage: publish
  only:
    - branches
  variables:
    DOCKER_IMAGE_TAG: ${CI_COMMIT_REF_SLUG}

# Publish tagged release
publish_tag:
  extends: .build
  stage: publish
  only:
    - tags
  except:
    - branches
  variables:
    DOCKER_IMAGE_TAG: ${CI_COMMIT_TAG}

# Publish tagged release
publish_latest:
  extends: .build
  stage: publish
  only:
    - tags
  except:
    - branches
  variables:
    DOCKER_IMAGE_TAG: latest
